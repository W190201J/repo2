if(angular.module("kitbag").controller("browseCtrl",["$http","$window","$scope","multiSelectFilter","priceFilter","config","$rootScope","$attrs","textHighlightService",function(a,e,l,o,s,c,u,t,i){var r,n,d,h,p=t.productsPerPage,f=t.requestUrl,g=-1,m=JSON.parse(t.categoryList);function v(e){var t,i,r=(t={},angular.forEach(l.multipleSelectFilters,function(e){t[e.Id]=e}),t);l.multipleSelectFilters=[],angular.forEach(e,function(e){void 0!==r[e.Id]&&angular.forEach(e.Options,function(t){angular.forEach(r[e.Id].Options,function(e){t.Id==e.Id&&e.IsSelected&&(t.IsSelected=!0)})}),o(e),l.multipleSelectFilters.push(e)}),i=[],angular.forEach(l.multipleSelectFilters,function(t){angular.forEach(t.Options,function(e){e.IsSelected&&i.push(t.Id+"/"+e.Id)})}),l.filterUrl=0<i.length?"/f/"+i.join("/"):""}function w(e){var t;e.data.Products&&0<e.data.Products.length?(null!=(t=e.data).CategoryFilter&&(l.categoryFilterTitle=t.CategoryFilter.Description,l.availableCategories=t.CategoryFilter.Options),t.PriceFilter&&(l.priceFilter=t.PriceFilter,s(t.PriceFilter)),0<t.MultipleSelectFilters.length&&v(t.MultipleSelectFilters),l.hasSearchResults=!0,l.searchResultLength=e.data.TotalNumberOfItems,l.hasNoMoreResults=b(e.data.Products.length)):(l.hasSearchResults=!1,l.searchResultLength=0),l.searchTerm=e.data.SearchTerm,l.categoryTitle=e.data.CategoryTitle,l.breadCrumbs=e.data.BreadCrumbs,l.showMemberPrices=e.data.ShowMemberPrices,l.alternativeSearchTerms=e.data.AlternativeSearchTerms,l.alternativeSearchTerm=l.hasAlternativeSearchTerms()?l.alternativeSearchTerms.join(", "):"",m=e.data.Categories,l.searchUrl=l.searchTerm?"/search/"+l.searchTerm:"",S(e)}function S(e){l.productData=e.data.Products}function T(e){l.productData=l.productData.concat(e.data.Products),l.hasNoMoreResults=b(e.data.Products.length)}function b(e){return e<p||e%p!=0}function y(){var r=[];return angular.forEach(l.multipleSelectFilters,function(e){var t=e.activeItems();if(0<t.length){var i={Id:e.Id,fullOptions:e.Options,Options:[]};angular.forEach(t,function(e){i.Options.push({Id:e.optionId})}),r.push(i)}}),r}function I(t,i,e,r){i=null==i?l.productData.length:i,r=void 0===r||r,(e=e||p)<p&&(e=p);var n={searchTerm:l.searchTerm,sort:l.sortOrder,startIndex:i,itemsToReturn:e,categories:m,multiSelectFilters:y(),priceFilter:function(){var e=l.priceFilter;if(M(e))return{};var t=parseInt(e.MinValue,10)-1||e.MinAvailableValue,i=parseInt(e.MaxValue,10)+1||e.MaxAvailableValue;return M(i)||M(t)||t==e.MinAvailableValue&&i==e.MaxAvailableValue?{}:{Id:e.Id,description:e.Description,minValue:t,maxValue:i,minAvailableValue:e.MinAvailableValue,maxAvailableValue:e.MaxAvailableValue,From:e.From,To:e.To}}(),generateSCodeScript:!V(),showMoreFilters:l.showMoreFilters.map(function(e){return{Id:e.Id,LinkType:e.LinkType}})};l.activateSpinner(),a.post(f,n).then(function(e){V()||$("script").last().append(e.data.SCodeScript),u.$broadcast(c.events.monetateRetrack,e.data.MonetateMethods),u.$broadcast(c.events.gtmPush,e.data.GoogleDataLayer),t(e),l.filtersApplied=!M(n.multiSelectFilters)||!M(n.priceFilter),x(i+e.data.Products.length,r),F(),l.deactivateSpinner()},function(){l.deactivateSpinner()})}function F(){var e=localStorage.getItem(t.viewPersistanceVariable);null!=e?l.setView(e):l.setView(t.defaultView)}function V(){return null!=window.s&&null!=window.s.prop27}function x(e,t){var i,r={multipleSelectFilters:y(),priceFilter:(i=l.priceFilter,M(i)?{}:{Id:i.Id,description:i.Description,minValue:i.MinValue,maxValue:i.MaxValue,minAvailableValue:i.MinAvailableValue,maxAvailableValue:i.MaxAvailableValue,From:i.From,To:i.To}),totalItems:e,sortOrder:l.sortOrder,url:window.location.href,scrollPosition:$("#ContentSection").scrollTop(),timeStamp:new Date,viewType:l.selectedView};t?window.history.pushState(r,"",window.location):window.history.replaceState(r,"",window.location)}function C(e){var t=window.history.state,i=new Date,r=new Date(i.getFullYear(),i.getMonth(),i.getDate()),n=new Date(r.getTime()-6048e5);null!=t&&t.timeStamp>=n?function(r,n){if(l.multipleSelectFilters=[],angular.forEach(r.multipleSelectFilters,function(e){var t={Id:e.Id,Options:e.fullOptions};o(t),l.multipleSelectFilters.push(t)}),M(r.priceFilter))l.priceFilter={};else{var e={Id:r.priceFilter.Id,Description:r.priceFilter.description,To:r.priceFilter.To,From:r.priceFilter.From,MaxValue:r.priceFilter.maxValue,MaxAvailableValue:r.priceFilter.maxAvailableValue,MinValue:r.priceFilter.minValue,MinAvailableValue:r.priceFilter.minAvailableValue};s(e),l.priceFilter=e}l.sortOrder=r.sortOrder,I(function(e){var t,i;n(e),t=r.scrollPosition,i=Number(new Date)+3e3,function e(){$("#ContentSection").prop("scrollHeight")>t||Number(new Date)>=i?$("#ContentSection").scrollTop(t):setTimeout(e,150)}()},0,r.totalItems,!1)}(t,e):I(e,0,p,!1)}function M(e){return null===e||angular.isUndefined(e)||angular.equals(e,{})||e instanceof Array&&0==e.length}function D(e){for(var t=0;t<l.filterData.length;t++)if(!angular.isUndefinedOrNull(l.filterData[t].Options))for(var i=0;i<l.filterData[t].Options.length;i++){var r=e(l.filterData[t].Options[i]);if(void 0!==r)return r}}l.showMembersPrice=function(e){return l.showMemberPrices&&e.MembersPrice!==e.Price&&e.MembersPrice},l.hasAlternativeSearchTerms=function(){return $.isArray(l.alternativeSearchTerms)&&0<l.alternativeSearchTerms.length},l.getMoreResults=(r=function(){g!=l.productData.length&&(g=l.productData.length,I(T,l.productData.length,p,!1))},n=1e3,d=!0,function(){var e=this,t=arguments,i=d&&!h;clearTimeout(h),h=setTimeout(function(){h=null,d||r.apply(e,t)},n),i&&r.apply(e,t)}),l.sortChanged=function(){l.sortOrder=$("#sortOrder").val(),null!=l.sortOrder&&""!=l.sortOrder&&I(S,0,l.productData.length,!1)},angular.forEach(["multipleSelectFilters","priceFilter"],function(e){l.$watch(e,function(){var e=l.multipleSelectFilters;M(l.priceFilter)||(e=e.concat(l.priceFilter)),l.filterData=e})}),l.$on("filtersApplied",function(){I(w,0)}),l.hasHighlightedText=function(e){return null!==e.HighlightedText},l.getHighlightedTextStyle=i.getHighlightedTextStyle,l.hasPendingRequests=function(){return 0<a.pendingRequests.length},l.filtersAvailable=function(){return 0<l.filterData.length},l.showCategoryFilter=function(){return""!=l.searchTerm&&0<l.availableCategories.length},l.hasFilters=function(){return l.hasSearchResults&&(l.showCategoryFilter()||0<l.filterData.length||!M(l.priceFilter))},l.showFilterMenu=function(){l.$broadcast("openFilterMenu")},l.toggleView=function(){"threeItems"==l.selectedView?l.setView("fourItems"):"fourItems"==l.selectedView?l.setView("threeItems"):"Grid"==l.selectedView?l.setView("List"):l.setView("Grid")},l.updateHistoryPoint=function(){l.productData&&x(l.productData.length,!1)},l.setView=function(e){l.productView="threeItems"==e||"fourItems"==e?(l.productViewStyle=e,"/stores/scripts/ProductBrowse/Product/productLayoutVariableItems.html"):"/stores/scripts/ProductBrowse/Product/productLayout"+e+".html",l.selectedView=e,l.updateHistoryPoint(),localStorage.setItem(t.viewPersistanceVariable,e)},F(),l.showHeader=function(){return l.hasSearchResults||l.filtersApplied},l.searchTerm=t.searchTerm,l.alternativeSearchTerms=[],v(JSON.parse(t.filterList)||[]),l.hasSearchResults=!0,l.searchResultLength=0,l.priceFilter={},l.productData=[],l.deactivateSpinner(),l.availableCategories=[],l.$on("$locationChangeSuccess",function(){C(w)}),l.getFilterView=function(e){return"/stores/scripts/ProductBrowse/Product/Desktop/"+e.viewType},l.toggleFilterOption=function(e){e.IsSelected=!e.IsSelected,g=-1,I(w,0)},l.showMoreFilters=[],l.toggleShowMore=function(e){var i,r,n;e.LinkType=1===e.LinkType?2:1,i=l.showMoreFilters,r=e,n=-1,i.filter(function(e,t){return e.Id===r.Id&&delete i[n=t],!0}),-1===n?i.push(r):i[n]=r,I(w,0)},l.hasFiltersApplied=function(){return D(function(e){if(e.IsSelected)return!0})},l.clearFilters=function(){D(function(e){e.IsSelected=!1}),g=-1,I(w,0)},l.applyFilters=function(){I(w,0)}}]),angular.module("kitbag").service("textHighlightService",[function(){this.getHighlightedTextStyle=function(e){var t={};return null!==e.HighlightedBackgroundHexColour&&(t.backgroundColor=e.HighlightedBackgroundHexColour),null!==e.HighlightedForegroundHexColour&&(t.color=e.HighlightedForegroundHexColour),t}}]),angular.module("kitbag").directive("lowerOrEqualTo",function(){return{restrict:"A",link:function(e,t,r,n){function i(e){var t=e||r.placeholder,i=r.lowerOrEqualTo;return a(t)&&a(i)&&t&&i?n.$setValidity("lowerOrEqualTo",parseInt(t,10)<=parseInt(i,10)):n.$setValidity("lowerOrEqualTo",!0),e}function a(e){var t=Math.floor(Number(e));return String(t)===e&&0<=t}n.$parsers.unshift(i),n.$formatters.push(i),r.$observe("lowerOrEqualTo",function(){return i(n.$viewValue)})},require:"ngModel"}}),angular.module("kitbag").factory("priceFilter",function(){return function(e){var t="MinValue",i="MaxValue";e.viewType="priceFilterOptionsView.html",Object.defineProperty(e,"priceFilterError",{get:function(){return $("#filterMenu").data("price-filter-error")}}),e.clear=function(){this.MinValue=null,this.MaxValue=null},e.activeItems=function(){var e=[];return this.addItemIfActive(t,"From",e),this.addItemIfActive(i,"To",e),e},e.validateMin=function(){this.validateRange(t)},e.validateMax=function(){this.validateRange(i)},e.validateRange=function(e){var t=this[e];t&&(t<this.MinAvailableValue&&(this[e]=this.MinAvailableValue),t>this.MaxAvailableValue&&(this[e]=this.MaxAvailableValue))},e.addItemIfActive=function(e,t,i){var r=this,n=r[e];if(null!=n&&!angular.isUndefined(n)){var a={optionDescription:n,filterDescription:r[t],reset:function(){r[e]=null}};i.push(a)}}}}).factory("multiSelectFilter",function(){return function(r){r.viewType=r.Type+"View.html",r.clear=function(){angular.forEach(this.Options,function(e){e.IsSelected=!1})},r.activeItems=function(){var i=[];return angular.forEach(this.Options,function(e){var t;e.IsSelected&&i.push((t=e,{reset:function(){t.IsSelected=!1},filterDescription:r.Description,optionId:t.Id,optionDescription:t.Description}))}),i}}}),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");!function(e){"use strict";var t=jQuery.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1==t[0]&&9==t[1]&&t[2]<1||3<t[0])throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(),function(d){"use strict";function l(n){return this.each(function(){var e=d(this),t=e.data("bs.carousel"),i=d.extend({},h.DEFAULTS,e.data(),"object"==typeof n&&n),r="string"==typeof n?n:i.slide;t||e.data("bs.carousel",t=new h(this,i)),"number"==typeof n?t.to(n):r?t[r]():i.interval&&t.pause().cycle()})}var h=function(e,t){this.$element=d(e),this.$indicators=this.$element.find(".carousel-indicators"),this.options=t,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",d.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",d.proxy(this.pause,this)).on("mouseleave.bs.carousel",d.proxy(this.cycle,this))};h.VERSION="3.3.7",h.TRANSITION_DURATION=600,h.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},h.prototype.keydown=function(e){if(!/input|textarea/i.test(e.target.tagName)){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()}},h.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(d.proxy(this.next,this),this.options.interval)),this},h.prototype.getItemIndex=function(e){return this.$items=e.parent().children(".item"),this.$items.index(e||this.$active)},h.prototype.getItemForDirection=function(e,t){var i=this.getItemIndex(t);if(("prev"==e&&0===i||"next"==e&&i==this.$items.length-1)&&!this.options.wrap)return t;var r=(i+("prev"==e?-1:1))%this.$items.length;return this.$items.eq(r)},h.prototype.to=function(e){var t=this,i=this.getItemIndex(this.$active=this.$element.find(".item.active"));return e>this.$items.length-1||e<0?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){t.to(e)}):i==e?this.pause().cycle():this.slide(i<e?"next":"prev",this.$items.eq(e))},h.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&d.support.transition&&(this.$element.trigger(d.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},h.prototype.next=function(){return this.sliding?void 0:this.slide("next")},h.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},h.prototype.slide=function(e,t){var i=this.$element.find(".item.active"),r=t||this.getItemForDirection(e,i),n=this.interval,a="next"==e?"left":"right",l=this;if(r.hasClass("active"))return this.sliding=!1;var o=r[0],s=d.Event("slide.bs.carousel",{relatedTarget:o,direction:a});if(this.$element.trigger(s),!s.isDefaultPrevented()){if(this.sliding=!0,n&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var c=d(this.$indicators.children()[this.getItemIndex(r)]);c&&c.addClass("active")}var u=d.Event("slid.bs.carousel",{relatedTarget:o,direction:a});return d.support.transition&&this.$element.hasClass("slide")?(r.addClass(e),r[0].offsetWidth,i.addClass(a),r.addClass(a),i.one("bsTransitionEnd",function(){r.removeClass([e,a].join(" ")).addClass("active"),i.removeClass(["active",a].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(u)},0)}).emulateTransitionEnd(h.TRANSITION_DURATION)):(i.removeClass("active"),r.addClass("active"),this.sliding=!1,this.$element.trigger(u)),n&&this.cycle(),this}};var e=d.fn.carousel;d.fn.carousel=l,d.fn.carousel.Constructor=h,d.fn.carousel.noConflict=function(){return d.fn.carousel=e,this};var t=function(e){var t,i=d(this),r=d(i.attr("data-target")||(t=i.attr("href"))&&t.replace(/.*(?=#[^\s]+$)/,""));if(r.hasClass("carousel")){var n=d.extend({},r.data(),i.data()),a=i.attr("data-slide-to");a&&(n.interval=!1),l.call(r,n),a&&r.data("bs.carousel").to(a),e.preventDefault()}};d(document).on("click.bs.carousel.data-api","[data-slide]",t).on("click.bs.carousel.data-api","[data-slide-to]",t),d(window).on("load",function(){d('[data-ride="carousel"]').each(function(){var e=d(this);l.call(e,e.data())})})}(jQuery),function(r){"use strict";r.fn.emulateTransitionEnd=function(e){var t=!1,i=this;r(this).one("bsTransitionEnd",function(){t=!0});return setTimeout(function(){t||r(i).trigger(r.support.transition.end)},e),this},r(function(){r.support.transition=function(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var i in t)if(void 0!==e.style[i])return{end:t[i]};return!1}(),r.support.transition&&(r.event.special.bsTransitionEnd={bindType:r.support.transition.end,delegateType:r.support.transition.end,handle:function(e){return r(e.target).is(this)?e.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),angular.module("kitbag").directive("brandSelectorCarousel",["$animate","$timeout","$q",function(h,p,f){return{scope:{campaigns:"="},templateUrl:"/Stores/Scripts/Shared/Directives/BrandSelector/BrandSelector.html",link:function(a,i){var l,o,s=i.find(".brandSelectorBrands"),c=i.find(".navigator"),u=35;function t(n){a.animating=!0;var e=s.children().map(function(e,t){var i=$(t),r=i.position().left;return h.animate(i,{left:r+"px"},{left:r+l*n+"px"},"carouselAnimation")});return f.all(e).then(function(){a.animating=!1})}function d(i){s.children().each(function(e,t){$(t).css("left",l*(e+i)+o)})}function r(e){var t,i,r=s.width(),n=a.selectedCampaign.Brands.length;l=e.outerWidth(!0),s.height(e.outerHeight(!0)),a.itemsFitWithoutScrolling=l*n<r,a.itemsFitWithoutScrolling?o=(r-l*n)/2:(t=Math.floor((r-2*u)/l),o=(i=(r-t*l)/2)-l,c.width(i),a.selectedCampaign.initialised||(a.selectedCampaign.Brands.unshift(a.selectedCampaign.Brands.pop()),a.selectedCampaign.initialised=!0),n-t<3&&function(){var e,t=a.selectedCampaign.Brands.length;for(e=0;e<t;e++)a.selectedCampaign.Brands.push(angular.copy(a.selectedCampaign.Brands[e]))}()),p(function(){d(0)})}a.selectCampaign=function(e){a.selectedCampaign=e,p(function(){var e,t;e=i.find(".brandSelectorBrandItem"),(t=e.find("img").eq(0))[0].complete?r(e):t.one("load",function(){r(e)})})},a.next=function(){if(!a.animating){var e=a.selectedCampaign.Brands[0];a.selectedCampaign.Brands.push(e),t(-1).then(function(){a.selectedCampaign.Brands.shift(),d(0)})}},a.previous=function(){if(!a.animating){d(-1);var e=a.selectedCampaign.Brands.pop();a.selectedCampaign.Brands.unshift(e),t(1)}},a.selectCampaign(a.campaigns[0])}}}]),angular.module("kitbag").directive("browseProduct",["textHighlightService",function(t){return{restrict:"E",templateUrl:"/stores/scripts/ProductBrowse/Product/productItem.html",scope:{product:"=",showMemberPrices:"=",hasHighlightedText:"=",updateHistoryPoint:"&"},link:function(e){e.getHighlightedTextStyle=t.getHighlightedTextStyle}}}]),function(){"use strict";angular.module("kitbag").directive("kbReviewSummary",["scrollToService",function(t){return{restrict:"E",templateUrl:"/Stores/Scripts/Shared/Directives/Reviews/review-summary.html",scope:{averageRating:"=",numberOfReviews:"=",scrollToElement:"=?",prefixFeefoLogo:"=?",suffixFeefoLogo:"=?",titleText:"="},link:function(e){e.scrollToReviews=function(){e.scrollToElement&&t.scrollToElement(e.scrollToElement)}}}}])}();